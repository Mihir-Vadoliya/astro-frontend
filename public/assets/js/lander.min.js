export default class Lander{customerId=null;pollingIntervalId=null;pollingIntervalTime=3e3;statusPending="pending";statusNotSold="not_sold";statusSold="sold";statusTimeout="timeout";init(){$("#nameForm").on("submit",e=>{e.preventDefault();this.showPendingScreen();this.sendRequest();this.pollingIntervalId=setInterval(()=>{this.checkState()},this.pollingIntervalTime)})}sendRequest(){let form=$("#nameForm");let data=form.serialize();$.ajax({type:"POST",url:form.attr("action"),cache:false,data:data,processData:false,dataType:"json"}).done(response=>{response.success?this.customerId=response.data.customer_id:this.showThankyouScreen()}).fail(error=>{console.log("error:",error)})}checkState(){if(this.customerId){$.ajax({method:"GET",url:`/checkStatus/${this.customerId}`,dataType:"json"}).done(response=>{if(response.status){this.sendGtmData(response.status,response.events?response.events:null);switch(response.status){case this.statusSold:this.showThankyouScreen();this.stopPolling();break;case this.statusNotSold:this.handleResponse(response);this.stopPolling();break;case this.statusTimeout:this.stopPolling();break}}}).fail(error=>{console.log("error",error)}).always(()=>{})}}showPendingScreen(){gotoNextStep(".gtm-screen-email",".gtm-screen-pending");$("body").css("overflow","visible")}showThankyouScreen(){gotoNextStep(".gtm-screen-pending",".gtm-screen-thankyou");$("body").css("overflow","visible")}handleResponse(response){switch(response.data.type){case"page":this.showThankyouScreen();break;case"redirect":window.location.href=response.data.url;break}}sendGtmData(status,events){if(status===this.statusPending){return}window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:"sell-status","gtm-status":status});for(let key in events){let value=events[key];let dataObject={event:`sell-event-${value["event"]}`,bid:value["bid"]};window.dataLayer.push(dataObject)}}stopPolling(){clearInterval(this.pollingIntervalId)}}window.lander=new Lander;window.lander.init();